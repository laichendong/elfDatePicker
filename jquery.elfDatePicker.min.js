(function(A){A.fn.elfDatePicker=function(B){A.fn.elfDatePicker._options=A.extend(A.fn.elfDatePicker._options,B);return this.each(function(){var D="elfDatePicker"+new Date().getTime();A(this).data("dpUUID",D);var C=A.fn.elfDatePicker.build(A(this),A.fn.elfDatePicker.stringToDate(A(this).val()));A.fn.elfDatePicker.eventHandller(A(this),C);A(this).focus(function(){var E=A.fn.elfDatePicker.stringToDate(A(this).val());if(E){A.fn.elfDatePicker.rend(C,E.getFullYear(),E.getMonth(),E)}else{A.fn.elfDatePicker.rend(C,new Date().getFullYear(),new Date().getMonth())}A.fn.elfDatePicker.setPosition(A(this),C);A.fn.elfDatePicker.show(C)}).click(function(){return false})})};A.fn.elfDatePicker._options={monthLabel:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],weekLabel:["日","一","二","三","四","五","六"],afterPicked:function(){},beginDate:"",endDate:""};A.fn.elfDatePicker.build=function(C,E){var D=C.data("dpUUID");var B=A('<div class="elfDatePicker" style="display:none;" id="'+D+'"></div>').appendTo("body");if(E){B=A.fn.elfDatePicker.rend(B,E.getFullYear(),E.getMonth(),E)}else{B=A.fn.elfDatePicker.rend(B,new Date().getFullYear(),new Date().getMonth())}return B};A.fn.elfDatePicker.rend=function(K,P,N,L){K.empty();K.append('<div class="elfDatePickerTitle clearfix">	<div class="elfDatePickerMonthWarp f_l clearfix">		<a class="elfDatePickerTitlePrevMonth f_l" title="上月" href="javascript:void(0);">﹤</a>		<span class="elfDatePickerMonth f_l" value="'+N+'">'+A.fn.elfDatePicker._options.monthLabel[N]+'</span>		<a class="elfDatePickerTitleNextMonth f_l" title="下月" href="javascript:void(0);">﹥</a>	</div>	<div class="elfDatePickerYearWarp f_r clearfix">		<a class="elfDatePickerTitleNextYear f_r" title="明年" href="javascript:void(0);">﹥</a>		<span class="elfDatePickerYear f_r">'+P+'</span>		<a class="elfDatePickerTitlePrevYear f_r" title="去年" href="javascript:void(0);">﹤</a>	</div></div>');K.append('<table class="elfDatePickerCalendar"><thead>	<tr></tr></thead><tbody></tbody></table>');A.each(A.fn.elfDatePicker._options.weekLabel,function(S,T){K.find(".elfDatePickerCalendar thead tr ").append('		<th><span title="星期'+this+'">'+this+"</span></th>")});var B=new Date(P,N,1);var R=A.fn.elfDatePicker.daysOfMonth(P,N);var G=new Date(P,N,R);var E="<tr>";for(var J=B.getDay();J>0;J--){var Q=m=d="";var O;if(N==0){O=A.fn.elfDatePicker.daysOfMonth(P-1,11);Q=(P-1)+"";m="12"}else{O=A.fn.elfDatePicker.daysOfMonth(P,N-1);Q=P+"";m=N+"";if(N<10){m="0"+N}}d=(O-J+1)+"";var F=Q+"-"+m+"-"+d;var M=A.fn.elfDatePicker.computNeedDisable(F);E+=('<td class="elfDatePickerCelDeactive '+(M?"elfDatePickerCelDisabled":"")+'" date="'+F+'">'+d+"</td>")}for(var I=1;I<=R;I++){var Q=m=d="";Q=P+"";if(parseInt(N)<9){m="0"+(parseInt(N)+1)}else{m=(parseInt(N)+1)+""}if(I<10){d="0"+I}else{d=I+""}var F=Q+"-"+m+"-"+d;var M=A.fn.elfDatePicker.computNeedDisable(F);E+=('<td date="'+F+'" class="'+(M?"elfDatePickerCelDisabled":"")+'">'+I+"</td>");if(new Date(P,N,I).getDay()==6){E+=("</tr><tr>")}}var D=1;for(var H=G.getDay();H<6;H++){var Q=m=d="";var O;if(parseInt(N)==11){Q=(P+1)+"";m="01"}else{Q=P+"";m=(parseInt(N)+2)+"";if(parseInt(N)<8){m="0"+(parseInt(N)+2)}}d="0"+D;var F=Q+"-"+m+"-"+d;var M=A.fn.elfDatePicker.computNeedDisable(F);E+=('<td class="elfDatePickerCelDeactive '+(M?"elfDatePickerCelDisabled":"")+'" date="'+F+'">'+D+"</td>");D++}E+=("</tr>");K.find(".elfDatePickerCalendar tbody").append(E);K.find(".elfDatePickerCalendar tbody td[date='"+A.fn.elfDatePicker.dateToString(new Date())+"']").addClass("elfDatePickerCelToday");if(L){K.find(".elfDatePickerCalendar tbody td[date='"+A.fn.elfDatePicker.dateToString(L)+"']").addClass("elfDatePickerCelChecked")}var C=A.fn.elfDatePicker.computNeedDisable(A.fn.elfDatePicker.dateToString(new Date()));K.append('<div class="elfDatePickerBottom clearfix">	<a class="elfDatePickerTodayBtn f_l '+(C?"disabledTodayBtn":"")+'" href="javascript:void(0);" title="选择今天">今天</a>	<a class="elfDatePickerClearBtn f_r" href="javascript:void(0);" title="清除选择">清除</a></div>');return K};A.fn.elfDatePicker.computNeedDisable=function(C){var B=false;if(A.fn.elfDatePicker._options.beginDate&&A.fn.elfDatePicker.stringToDate(C)<A.fn.elfDatePicker.stringToDate(A.fn.elfDatePicker._options.beginDate)){B=true}if(A.fn.elfDatePicker._options.endDate&&A.fn.elfDatePicker.stringToDate(C)>A.fn.elfDatePicker.stringToDate(A.fn.elfDatePicker._options.endDate)){B=true}if(A.fn.elfDatePicker._options.beginDate&&A.fn.elfDatePicker._options.endDate&&A.fn.elfDatePicker._options.beginDate>A.fn.elfDatePicker._options.endDate){B=false}return B};A.fn.elfDatePicker.eventHandller=function(C,B){var E="#"+B.attr("id");A(E+" .elfDatePickerCalendar td:not(.elfDatePickerCelDisabled)").live("mouseover",function(){A(this).addClass("elfDatePickerCelHover")});A(E+" .elfDatePickerCalendar td:not(.elfDatePickerCelDisabled)").live("mouseout",function(){A(this).removeClass("elfDatePickerCelHover")});A(E+" .elfDatePickerCalendar td:not(.elfDatePickerCelDisabled)").live("click",function(){A("td").removeClass(E+" elfDatePickerCelChecked");A(this).addClass(E+" elfDatePickerCelChecked");C.val(A(this).attr("date"));A.fn.elfDatePicker.hide(B);if(A.fn.elfDatePicker._options.afterPicked){A.fn.elfDatePicker._options.afterPicked()}});A(E+" .elfDatePickerTitlePrevMonth").live("click",function(){var G=A(E+" .elfDatePickerYear").text();var H=A(E+" .elfDatePickerMonth").attr("value");if(H==0){G--;H=11}else{H--}A(E+" .elfDatePickerYear").text(G);A(E+" .elfDatePickerMonth").attr("value",H).text(A.fn.elfDatePicker._options.monthLabel[H]);A.fn.elfDatePicker.rend(B,G,H)});A(E+" .elfDatePickerTitleNextMonth").live("click",function(){var G=A(E+" .elfDatePickerYear").text();var H=A(E+" .elfDatePickerMonth").attr("value");if(H==11){G++;H=0}else{H++}A(E+" .elfDatePickerYear").text(G);A(E+" .elfDatePickerMonth").attr("value",H).text(A.fn.elfDatePicker._options.monthLabel[H]);A.fn.elfDatePicker.rend(B,G,H)});A(E+" .elfDatePickerTitlePrevYear").live("click",function(){var G=A(E+" .elfDatePickerYear").text();var H=A(E+" .elfDatePickerMonth").attr("value");G--;A(E+" .elfDatePickerYear").text(G);A(E+" .elfDatePickerMonth").attr("value",H).text(A.fn.elfDatePicker._options.monthLabel[H]);A.fn.elfDatePicker.rend(B,G,H)});A(E+" .elfDatePickerTitleNextYear").live("click",function(){var G=A(E+" .elfDatePickerYear").text();var H=A(E+" .elfDatePickerMonth").attr("value");G++;A(E+" .elfDatePickerYear").text(G);A(E+" .elfDatePickerMonth").attr("value",H).text(A.fn.elfDatePicker._options.monthLabel[H]);A.fn.elfDatePicker.rend(B,G,H)});A(E+" .elfDatePickerTodayBtn:not(.disabledTodayBtn)").live("click",function(){C.val(A.fn.elfDatePicker.dateToString(new Date()));A.fn.elfDatePicker.hide(B)});A(E+" .elfDatePickerClearBtn").live("click",function(){C.val("");A.fn.elfDatePicker.hide(B)});function F(G,H){for(var I=0;I<H.length;I++){var J=H[I];if(G.x>=J.left&&G.x<=(J.left+J.width)&&G.y>=J.top&&G.y<=(J.top+J.height)){return true}}return false}var D=function(I){var G={x:I.pageX,y:I.pageY};var H=[];A.each(A(".elfDatePicker:visible"),function(){var J={left:A(this).offset().left,top:A(this).offset().top,width:A(this).outerWidth(),height:A(this).outerHeight()};H.push(J)});if(!F(G,H)){A(".elfDatePicker").hide(200)}};A("body").unbind("click",D).bind("click",D)};A.fn.elfDatePicker.show=function(B){A(".elfDatePicker").stop(true,true).hide();B.css("position","absolute").show(200)};A.fn.elfDatePicker.hide=function(B){B.hide(200)};A.fn.elfDatePicker.setPosition=function(C,B){B.css({left:C.offset().left,top:C.offset().top+C.outerHeight()})};A.fn.elfDatePicker.dateToString=function(B){var C=B.getFullYear();var D=B.getMonth()+1;if(D<10){D="0"+D}var B=B.getDate();if(B<10){B="0"+B}return C+"-"+D+"-"+B};A.fn.elfDatePicker.stringToDate=function(C){var B=C.match(/(\d{4})-(\d{2})-(\d{2})/);try{var E=A.fn.elfDatePicker.daysOfMonth(B[1],(B[2]-1));if(B[3]<=E){return new Date(B[1],(B[2]-1),B[3])}else{return undefined}}catch(D){return undefined}};A.fn.elfDatePicker.daysOfMonth=function(B,C){return new Date(B,C+1,0).getDate()};A.elfDatePicker=function(B){A(":text.dateInputer").elfDatePicker(B)}})(jQuery)